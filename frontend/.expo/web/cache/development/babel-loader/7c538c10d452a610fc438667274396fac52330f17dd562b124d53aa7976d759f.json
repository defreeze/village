{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport * as FileSystem from 'expo-file-system';\nimport PropTypes from 'prop-types';\nimport React, { useEffect, useRef, useState } from 'react';\nimport Image from \"react-native-web/dist/exports/Image\";\nvar CachedImage = function CachedImage(props) {\n  var uri = props.source.uri,\n    cacheKey = props.cacheKey;\n  var filesystemURI = \"\" + FileSystem.cacheDirectory + cacheKey;\n  var _useState = useState(filesystemURI),\n    _useState2 = _slicedToArray(_useState, 2),\n    imgURI = _useState2[0],\n    setImgURI = _useState2[1];\n  var componentIsMounted = useRef(true);\n  useEffect(function () {\n    var loadImage = function loadImage(_ref) {\n      var fileURI, metadata;\n      return _regeneratorRuntime.async(function loadImage$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            fileURI = _ref.fileURI;\n            _context.prev = 1;\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(FileSystem.getInfoAsync(fileURI));\n          case 4:\n            metadata = _context.sent;\n            if (metadata.exists) {\n              _context.next = 11;\n              break;\n            }\n            if (!componentIsMounted.current) {\n              _context.next = 10;\n              break;\n            }\n            setImgURI(null);\n            _context.next = 10;\n            return _regeneratorRuntime.awrap(FileSystem.downloadAsync(uri, fileURI));\n          case 10:\n            if (componentIsMounted.current) {\n              setImgURI(fileURI);\n            }\n          case 11:\n            _context.next = 16;\n            break;\n          case 13:\n            _context.prev = 13;\n            _context.t0 = _context[\"catch\"](1);\n            setImgURI(uri);\n          case 16:\n          case \"end\":\n            return _context.stop();\n        }\n      }, null, null, [[1, 13]], Promise);\n    };\n    loadImage({\n      fileURI: filesystemURI\n    });\n    return function () {\n      componentIsMounted.current = false;\n    };\n  }, []);\n  return React.createElement(Image, _extends({}, props, {\n    source: {\n      uri: imgURI\n    }\n  }));\n};\nCachedImage.propTypes = {\n  source: PropTypes.object.isRequired,\n  cacheKey: PropTypes.string.isRequired\n};\nexport default CachedImage;","map":{"version":3,"names":["FileSystem","PropTypes","React","useEffect","useRef","useState","Image","CachedImage","props","uri","source","cacheKey","filesystemURI","cacheDirectory","_useState","_useState2","_slicedToArray","imgURI","setImgURI","componentIsMounted","loadImage","_ref","fileURI","metadata","_regeneratorRuntime","async","loadImage$","_context","prev","next","awrap","getInfoAsync","sent","exists","current","downloadAsync","t0","stop","Promise","createElement","_extends","propTypes","object","isRequired","string"],"sources":["C:/Users/alexd/Documents/InstagramClone/frontend/components/main/random/CachedImage.js"],"sourcesContent":["import * as FileSystem from 'expo-file-system'\r\nimport PropTypes from 'prop-types'\r\nimport React, { useEffect, useRef, useState } from 'react'\r\nimport { Image } from 'react-native'\r\n\r\n\r\n\r\n\r\nconst CachedImage = props => {\r\n  const { source: { uri }, cacheKey } = props\r\n  const filesystemURI = `${FileSystem.cacheDirectory}${cacheKey}`\r\n\r\n  const [imgURI, setImgURI] = useState(filesystemURI)\r\n\r\n  const componentIsMounted = useRef(true)\r\n\r\n  useEffect(() => {\r\n    const loadImage = async ({ fileURI }) => {\r\n      try {\r\n        // Use the cached image if it exists\r\n        const metadata = await FileSystem.getInfoAsync(fileURI)\r\n        if (!metadata.exists) {\r\n          // download to cache\r\n          if (componentIsMounted.current) {\r\n            setImgURI(null)\r\n            await FileSystem.downloadAsync(\r\n              uri,\r\n              fileURI\r\n            )\r\n          }\r\n          if (componentIsMounted.current) {\r\n            setImgURI(fileURI)\r\n          }\r\n        }\r\n      } catch (err) {\r\n        setImgURI(uri)\r\n      }\r\n    }\r\n\r\n    loadImage({ fileURI: filesystemURI })\r\n\r\n    return () => {\r\n      componentIsMounted.current = false\r\n    }\r\n  }, [])// eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  return (\r\n    <Image\r\n      // eslint-disable-next-line react/jsx-props-no-spreading\r\n      {...props}\r\n      source={{\r\n        uri: imgURI,\r\n      }}\r\n    />\r\n  )\r\n}\r\n\r\nCachedImage.propTypes = {\r\n  source: PropTypes.object.isRequired,\r\n  cacheKey: PropTypes.string.isRequired,\r\n}\r\n\r\nexport default CachedImage\r\n"],"mappings":";;;AAAA,OAAO,KAAKA,UAAU,MAAM,kBAAkB;AAC9C,OAAOC,SAAS,MAAM,YAAY;AAClC,OAAOC,KAAK,IAAIC,SAAS,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,OAAO;AAAA,OAAAC,KAAA;AAM1D,IAAMC,WAAW,GAAG,SAAdA,WAAWA,CAAGC,KAAK,EAAI;EAC3B,IAAkBC,GAAG,GAAiBD,KAAK,CAAnCE,MAAM,CAAID,GAAG;IAAIE,QAAQ,GAAKH,KAAK,CAAlBG,QAAQ;EACjC,IAAMC,aAAa,QAAMZ,UAAU,CAACa,cAAc,GAAGF,QAAU;EAE/D,IAAAG,SAAA,GAA4BT,QAAQ,CAACO,aAAa,CAAC;IAAAG,UAAA,GAAAC,cAAA,CAAAF,SAAA;IAA5CG,MAAM,GAAAF,UAAA;IAAEG,SAAS,GAAAH,UAAA;EAExB,IAAMI,kBAAkB,GAAGf,MAAM,CAAC,IAAI,CAAC;EAEvCD,SAAS,CAAC,YAAM;IACd,IAAMiB,SAAS,GAAG,SAAZA,SAASA,CAAAC,IAAA;MAAA,IAAAC,OAAA,EAAAC,QAAA;MAAA,OAAAC,mBAAA,CAAAC,KAAA,UAAAC,WAAAC,QAAA;QAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;UAAA;YAAYP,OAAO,GAAAD,IAAA,CAAPC,OAAO;YAAAK,QAAA,CAAAC,IAAA;YAAAD,QAAA,CAAAE,IAAA;YAAA,OAAAL,mBAAA,CAAAM,KAAA,CAGP9B,UAAU,CAAC+B,YAAY,CAACT,OAAO,CAAC;UAAA;YAAjDC,QAAQ,GAAAI,QAAA,CAAAK,IAAA;YAAA,IACTT,QAAQ,CAACU,MAAM;cAAAN,QAAA,CAAAE,IAAA;cAAA;YAAA;YAAA,KAEdV,kBAAkB,CAACe,OAAO;cAAAP,QAAA,CAAAE,IAAA;cAAA;YAAA;YAC5BX,SAAS,CAAC,IAAI,CAAC;YAAAS,QAAA,CAAAE,IAAA;YAAA,OAAAL,mBAAA,CAAAM,KAAA,CACT9B,UAAU,CAACmC,aAAa,CAC5B1B,GAAG,EACHa,OACF,CAAC;UAAA;YAEH,IAAIH,kBAAkB,CAACe,OAAO,EAAE;cAC9BhB,SAAS,CAACI,OAAO,CAAC;YACpB;UAAC;YAAAK,QAAA,CAAAE,IAAA;YAAA;UAAA;YAAAF,QAAA,CAAAC,IAAA;YAAAD,QAAA,CAAAS,EAAA,GAAAT,QAAA;YAGHT,SAAS,CAACT,GAAG,CAAC;UAAA;UAAA;YAAA,OAAAkB,QAAA,CAAAU,IAAA;QAAA;MAAA,0BAAAC,OAAA;IAAA,CAEjB;IAEDlB,SAAS,CAAC;MAAEE,OAAO,EAAEV;IAAc,CAAC,CAAC;IAErC,OAAO,YAAM;MACXO,kBAAkB,CAACe,OAAO,GAAG,KAAK;IACpC,CAAC;EACH,CAAC,EAAE,EAAE,CAAC;EAEN,OACEhC,KAAA,CAAAqC,aAAA,CAACjC,KAAK,EAAAkC,QAAA,KAEAhC,KAAK;IACTE,MAAM,EAAE;MACND,GAAG,EAAEQ;IACP;EAAE,EACH,CAAC;AAEN,CAAC;AAEDV,WAAW,CAACkC,SAAS,GAAG;EACtB/B,MAAM,EAAET,SAAS,CAACyC,MAAM,CAACC,UAAU;EACnChC,QAAQ,EAAEV,SAAS,CAAC2C,MAAM,CAACD;AAC7B,CAAC;AAED,eAAepC,WAAW","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}